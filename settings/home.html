<!--
Copyright (C) 2022 The Fake Slim Shady

SPDX-License-Identifier: MIT
-->

<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <link href='../style.css' rel='stylesheet' />
    <title>Settings</title>

    <style>
        /* The Modal (background) */
        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 1;
            /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background: rgba(100, 100, 100, 0.3);
            backdrop-filter: blur(1.4rem);
        }

        /* Modal Content/Box */
        .modal-content {
            background-color: var(--bg-docs);
            margin: 15% auto;
            /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid var(--p-input-bd);
            width: 80%;
            /* Could be more or less, depending on screen size */
        }

        /* The Close Button */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>

<body>
<!-- Button for Widget Alert -->
<a href="#" class="p-btn" style="display: none" id="widget-alert-button" data-p-open-modal="#widget-alert"></a>
<div class="p-modal-background">
    <div class="p-modal" id="widget-alert">
        <h2>Error</h2>
        <p>Widget with that name already exists! Please choose another name or delete the existing widget.</p>
        <div class="p-modal-button-container">
            <a href="#" data-p-cancel>OK</a>
        </div>
    </div>
</div>
<!-- The Modal -->
<div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <span class="close">&times;</span><br>
        <form action="#" onsubmit="createWidget();">
            Name: <input data-kioskboard-type="keyboard" class="p-form-text p-form-no-validate" required id="name2" type="text"><br>
            URL: <div class="p-form-select"><select id="protocol">
            <option value="http://">http</option>
            <option value="https://">https</option>
            <option value="http://">IDK</option>
        </select></div> :// <input class="p-form-text p-form-no-validate" data-kioskboard-specialcharacters="true" id="url" required type="text"><br>
            <input class="p-btn p-prim-col" type="submit" value="Done">

        </form>

    </div>

</div>
<div id="settingsMenuBar"><span onclick="window.location = '../src/settings.html'"><span class="material-icons-round">arrow_back_ios</span> Settings</span></div>
<br><br>
<h1>
    Background
</h1>
<label for="background_delay">Change background image every: </label>
<input class="p-form-text p-form-no-validate" required min="5" max="10000000" type="number" oninput="if(this.value !== '') { settings.set('background_refresh_rate', this.value * 1000) }" id="background_delay">
<label for="background_delay">seconds.</label>
<h1>
    Widgets
</h1>

<ul id="ul" class="setting-list">
</ul>
<a href="#" onclick="settings.set(`editingHome`, true); window.location = '../src/index.html'">Edit widget
    locations</a><br><br>
<div class="range-slider__container">
    Widget width: 30px <input id="width"  class="p-form-range" oninput="changeSize()" type="range" min="30" max="500"> 500px
</div><br>
<div class="range-slider__container">
    Widget height: 30px <input id="height" class="p-form-range" oninput="changeSize()" type="range" min="30" max="500"> 500px
</div>
<div class="widget" id="example"><h3>Widgets look like this</h3></div>
<div onclick="document.getElementById('autoload').click();" class="switchoption">
    <label class="switchtext">Autoload all widgets (unrecomended)</label>
    <label class="p-form-switch">
        <input type="checkbox" oninput="settings.set('autoloadWidgets', this.checked)" id="autoload">
        <span></span>
    </label>
</div>
<script src="../scripts/universal.js"></script>
<script>
    document.getElementById("background_delay").value = settings.get('background_refresh_rate', 10000) / 1000
    document.getElementById("width").value = settings.get("widgetWidth", 200);
    document.getElementById("height").value = settings.get("widgetHeight", 200);
    document.getElementById("autoload").checked = settings.get("autoloadWidgets", false);
    function changeSize() {
        document.getElementById("example").style.width = document.getElementById("width").value + "px";
        document.getElementById("example").style.height = document.getElementById("height").value + "px";
        settings.set("widgetWidth", document.getElementById("width").value);
        settings.set("widgetHeight", document.getElementById("height").value);

    }
    changeSize();
    function openForm() {
        // Get the modal
        var modal = document.getElementById("myModal");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        modal.style.display = "block";

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    }
    var widgets = settings.get("widgets", [
        {
            name: "Traffic",
            url: "https://www.google.com/maps/"
        },
        {
            name: "Weather",
            url: "https://weather.com/weather/today/"
        },
        {
            name: "Calendar",
            url: "https://calendar.google.com/calendar/u/0/r/customday"
        }]);
    function refreshWidgets() {
        document.getElementById("ul").innerHTML = `<li onclick="openForm()"><span class="material-icons-round">
add
</span>New</li>`;
        widgets.forEach(widget => {
            var li = document.createElement("li");
            li.innerHTML = widget.name + ` <a onclick="deleteWidget('` + widget.name + `')"><span class="material-icons-round">
delete
</span></a>`
            document.getElementById("ul").appendChild(li);
        });
    }
    refreshWidgets();
    function deleteWidget(name, url) {
        // All of this was automatically generated by GitHub Copilot. Creepy. Worked first try without any editing.
        widgets.splice(widgets.findIndex(item => item.name === name), 1);
        settings.set("widgets", widgets);
        refreshWidgets();
        settings.delete("dragPositions");
    }
    function createWidget() {
        // I'm gonna be out of a job soon.
        if (widgets.findIndex(item => item.name === document.getElementById("name2").value) !== -1) {
            document.getElementById("widget-alert-button").click();
            return;
        }
        widgets.push(
            {
                name: document.getElementById("name2").value, url: document.getElementById("protocol").value + document.getElementById("url").value
            });
        settings.set("widgets", widgets);
        settings.delete("dragPositions");
        refreshWidgets();
        document.getElementById("myModal").style.display = "none";
    }
</script>
</div>
<script src="../assets/pupertino/modals.js"></script>

</body>

</html>